<!doctype html>
<head>
  <title>unit-convert</title>

  <script src="../../webcomponentsjs/webcomponents.js"></script>
  <script src="../../web-component-tester/browser.js"></script>
  <script src="../../test-fixture/test-fixture-mocha.js"></script>

  <link rel="import" href="../../polymer/polymer.html">
  <link rel="import" href="../../test-fixture/test-fixture.html">
  <link rel="import" href="../polymer-unit-convert.html">
</head>
<body>
  <test-fixture id="UnitConvert">
    <template>
      <unit-convert></unit-convert>
    </template>
  </test-fixture>
  <script>

  suite('<unit-convert>', function() {

    var el;

    setup(function () {
      el = fixture('UnitConvert');
    });

    suite('basic usage', function() {

      var testValues = {
        from: "kilometer",
        to: "mile",
        value: 1234
      };

      setup(function() {
        el.from = testValues.from.toString();
        el.to = testValues.to.toString();
        el.value = parseInt(testValues.value, 10);
      });

      test('input values are set properly', function() {
        expect(el.from).to.be.equal(testValues.from);
        expect(el.to).to.be.equal(testValues.to);
        expect(el.value).to.be.equal(testValues.value);
      });

    });

    suite('base unit', function() {

      test('matches are detected', function() {
        expect(el.baseUnitMatches('meter', 'meter')).to.be.true;
        expect(el.baseUnitMatches('meter', 'kilometer')).to.be.true;
        expect(el.baseUnitMatches('meter', 'mile')).to.be.false;
        expect(el.baseUnitMatches('mile', 'meter')).to.be.false;
        expect(el.baseUnitMatches('kilometer', 'kilometer')).to.be.true;
        expect(el.baseUnitMatches('kilometer', 'meter')).to.be.false;
      });

      test('can be looked up', function() {
        expect(el.getBaseUnit('meter')).to.be.equal('meter');
        expect(el.getBaseUnit('kilometer')).to.be.equal('meter');
        expect(el.getBaseUnit('meter')).to.be.equal('meter');
        expect(el.getBaseUnit('meter')).to.be.equal('meter');

        expect(el.baseUnitMatches('meter', 'kilometer')).to.be.true;
        expect(el.baseUnitMatches('meter', 'mile')).to.be.false;
        expect(el.baseUnitMatches('mile', 'meter')).to.be.false;
        expect(el.baseUnitMatches('kilometer', 'kilometer')).to.be.true;
        expect(el.baseUnitMatches('kilometer', 'meter')).to.be.false;
      });

    });

    suite('unit meter', function() {

      setup(function() {
        el.from = el.to = 'meter';
      }); 

      test('meter is already normalized', function() {
        el.value = 23;
        expect(el.normalizedValue).to.be.equal(23);
      });

      test('can be converted to mile', function() {

        el.to = 'mile';

        el.value = 1;
        expect(el.result).to.be.equal(meterToMile(el.value));

      });

      test('can be converted to yard', function() {

        el.to = 'yard';

        el.value = 1;
        expect(el.normalizedValue).to.be.equal(1);
        expect(el.result).to.be.equal(meterToYard(el.value));

      });

      test('provides interface to calculate function', function() {
        expect(el.normalize).to.be.a('function');

        expect(el.calculate('mile', 'meter', 100)).to.be.equal(160934.4);
        expect(el.calculate('mile', 'kilometer', 100)).to.be.equal(160.934);
        expect(el.calculate('meter', 'mile', 10)).to.be.equal(1);
        expect(el.calculate('centimeter', 'yard', 91.44)).to.be.equal(1);
      });

    });

    suite('unit kilometer', function() {

      setup(function() {
        el.from = el.to = 'kilometer';
      }); 

      test('kilometer is normalized correctly', function() {
        el.value = 23;
        expect(el.normalizedValue).to.be.equal(23000);
      });

      test('can be converted to mile', function() {

        el.to = 'mile';

        el.value = 1;
        expect(el.result).to.be.equal(meterToMile(el.value) * 1000);

      });

      test('can be converted to yard', function() {

        el.to = 'yard';

        el.value = 1;
        expect(el.normalizedValue).to.be.equal(1000);
        expect(el.result).to.be.equal(meterToYard(el.value) * 1000);

      });

    });

  });

  function meterToMile(meter) {
    return yardToMile(meterToYard(meter));
  }

  function yardToMile(yard) {
    return yard / 1760;
  }

  function meterToYard(meter) {
    return meter / 0.9144;
  }

  </script>
</body>